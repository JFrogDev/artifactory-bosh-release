desc 'bump and release patch version, create and push gem to Gemfury'
task :release => [:rebase] do
  sh "gem bump " + \
    "--version patch " + \
    "--commit " + \
    "--tag " + \
    "--push"

  gemspec = Dir["*.gemspec"].first
  raise "No .gemspec could be found!" unless gemspec
  sh "gem build #{gemspec}"

  new_gem = Dir["*.gem"].sort_by { |file| File.stat(file).ctime }.last
  raise "Could not find newly created gem!" unless new_gem
  sh "fury push #{new_gem}"
end

desc 'bump minor'
task :bump_minor => [:rebase] do
  sh "gem bump " +
    "--version minor " +
    "--commit " +
    "--tag " +
    "--push"
end

task :rebase do
  sh "git pull --rebase"
end

